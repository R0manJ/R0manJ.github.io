<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh_cn">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="R0hman の 实验室">
<meta property="og:url" content="http://github.com/r0manj/page/5/index.html">
<meta property="og:site_name" content="R0hman の 实验室">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Rohman.Zhu">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://github.com/r0manj/page/5/"/>





  <title>R0hman の 实验室</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh_cn">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
	<a href="https://github.com/r0manj" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">R0hman の 实验室</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-list"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />
            
            Schedule
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://github.com/r0manj/2020/06/14/%E8%AE%B0%E4%B8%80%E6%AC%A1IO%E5%BC%95%E8%B5%B7%E7%9A%84%E6%95%85%E9%9A%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rohman.Zhu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="R0hman の 实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/14/%E8%AE%B0%E4%B8%80%E6%AC%A1IO%E5%BC%95%E8%B5%B7%E7%9A%84%E6%95%85%E9%9A%9C/" itemprop="url">记一次IO引起的故障</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-14T14:35:40+08:00">
                2020-06-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Windows-Server/" itemprop="url" rel="index">
                    <span itemprop="name">Windows Server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><ul>
<li>用户反馈应用访问特别慢。</li>
<li>Windows Server中查看的磁盘IO状态，看到数据库相关的进程Response Time(ms)达到200以上。</li>
<li>在虚拟化监控平台vRealize中查看虚拟磁盘总IO延迟：<ul>
<li>总IOPS达到 10000 + ；</li>
</ul>
</li>
</ul>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>服务器的IO过高，底层没有来得及处理IO请求，新的IO请求已进入，因此导致高延迟。</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>找到IO的瓶颈，逐个扩容:</p>
<ol>
<li>硬件层调整，UCS的刀片IO更改默认值。</li>
<li>虚拟化层调整，改用PV SCSI</li>
<li>操作系统层注册此SCSI控住器：</li>
</ol>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add HKLM\SYSTEM\CurrentControlSet\services\pvscsi\Parameters\Device / DriverParameter /t REG_SZ /d "RequestRingPages=<span class="number">32</span>,MaxQueueDepth=<span class="number">254</span>"</span><br></pre></td></tr></table></figure>

<h1 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h1><h2 id="pvscsi-的-IO是多少？"><a href="#pvscsi-的-IO是多少？" class="headerlink" title="pvscsi 的 IO是多少？"></a>pvscsi 的 IO是多少？</h2><p>参考资料 ： </p>
<ul>
<li><a href="https://blogs.vmware.com/vsphere/2014/03/pvscsi-large-ios.html" target="_blank" rel="noopener">https://blogs.vmware.com/vsphere/2014/03/pvscsi-large-ios.html</a></li>
<li><a href="https://blog.csdn.net/weixin_34054866/article/details/85184550" target="_blank" rel="noopener">https://blog.csdn.net/weixin_34054866/article/details/85184550</a></li>
<li><a href="https://kb.vmware.com/s/article/1017652" target="_blank" rel="noopener">https://kb.vmware.com/s/article/1017652</a></li>
<li><a href="https://blogs.vmware.com/performance/2010/02/highperformance-pvsci-storage-adapter-can-reduce-cpio-by-1030.html" target="_blank" rel="noopener">https://blogs.vmware.com/performance/2010/02/highperformance-pvsci-storage-adapter-can-reduce-cpio-by-1030.html</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://github.com/r0manj/2020/06/07/CentOS%E7%BB%91%E5%AE%9ABond/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rohman.Zhu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="R0hman の 实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/07/CentOS%E7%BB%91%E5%AE%9ABond/" itemprop="url">CentOS7绑定Bond</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-07T13:04:56+08:00">
                2020-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/CentOS/" itemprop="url" rel="index">
                    <span itemprop="name">CentOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h1><ol>
<li>sudo 或者 root 权限下操作。</li>
<li>关闭NetworkManager （systemctl disable NetworkManager)</li>
<li>配置DNS（/etc/resolv.conf)</li>
<li>加载bonding模块（modprobe bonding）</li>
<li>设置网卡配置文件。</li>
</ol>
<h2 id="创建bond0网卡配置文件"><a href="#创建bond0网卡配置文件" class="headerlink" title="创建bond0网卡配置文件"></a>创建bond0网卡配置文件</h2><p>vim /etc/sysconfig/network-scripts/ifcfg-bond0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DEVICE&#x3D;bond0</span><br><span class="line">Type&#x3D;Bond</span><br><span class="line">NAME&#x3D;bond0</span><br><span class="line">BONDING_ASTER&#x3D;yes</span><br><span class="line">BOOTPROTO&#x3D;none</span><br><span class="line">ONBOOT&#x3D;yes</span><br><span class="line">IPADDR&#x3D;192.168.1.1</span><br><span class="line">PREFIX&#x3D;24</span><br><span class="line">GATEWAY&#x3D;192.168.1.254</span><br><span class="line">NM_CONTROLLED&#x3D;no</span><br><span class="line">BONDING_OPTS&#x3D;&quot;mode&#x3D;4 miimon&#x3D;100 lacp_rate&#x3D;1&quot;</span><br></pre></td></tr></table></figure>

<h2 id="更改salve物理网卡的配置文件"><a href="#更改salve物理网卡的配置文件" class="headerlink" title="更改salve物理网卡的配置文件"></a>更改salve物理网卡的配置文件</h2><p>例如 网卡 eno1 ， eno2 做成bond 。</p>
<p>vim  /etc/sysconfig/network-scripts/ifcfg-eno1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DEVICE&#x3D;eno1</span><br><span class="line">TYPE&#x3D;Ethernet</span><br><span class="line">BOOTPROTO&#x3D;none</span><br><span class="line">ONBOOT&#x3D;yes</span><br><span class="line">NM_CONTROLLED&#x3D;no</span><br><span class="line">IPV6INIT&#x3D;no</span><br><span class="line">MASTER&#x3D;bond0</span><br><span class="line">SLAVE&#x3D;yes</span><br></pre></td></tr></table></figure>

<p>vim /etc/sysconfig/network-scripts/ifcfg-eno2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DEVICE&#x3D;eno2</span><br><span class="line">TYPE&#x3D;Ethernet</span><br><span class="line">BOOTPROTO&#x3D;none</span><br><span class="line">ONBOOT&#x3D;yes</span><br><span class="line">NM_CONTROLLED&#x3D;no</span><br><span class="line">IPV6INIT&#x3D;no</span><br><span class="line">MASTER&#x3D;bond0</span><br><span class="line">SLAVE&#x3D;yes</span><br></pre></td></tr></table></figure>

<p>修改完后重启。</p>
<h2 id="检测bond的状态"><a href="#检测bond的状态" class="headerlink" title="检测bond的状态"></a>检测bond的状态</h2><p>cat /proc/net/bonding/bond0</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://www.snel.com/support/setup-lacp-bonding-interface-centos-7/" target="_blank" rel="noopener">https://www.snel.com/support/setup-lacp-bonding-interface-centos-7/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://github.com/r0manj/2020/06/01/Ubuntu18-04%E7%BB%91%E5%AE%9Abond/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rohman.Zhu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="R0hman の 实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/01/Ubuntu18-04%E7%BB%91%E5%AE%9Abond/" itemprop="url">Ubuntu18.04绑定bond</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-01T12:37:07+08:00">
                2020-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/Ubuntu/" itemprop="url" rel="index">
                    <span itemprop="name">Ubuntu</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h1><ol>
<li>sudo 或者 root 权限下操作。</li>
<li>安装 ifenslave 依赖。</li>
<li>加载 bonding 内核模块。</li>
<li>设置好交换机的配置。</li>
<li>设置网卡配置文件。</li>
</ol>
<h1 id="网卡配置"><a href="#网卡配置" class="headerlink" title="网卡配置"></a>网卡配置</h1><p>将网卡 eno1 ， eno2 做成bond。</p>
<p>编辑配置文件 /etc/netplan/xxx.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This file is generated from information provided by</span></span><br><span class="line"><span class="comment"># the datasource.  Changes to it will not persist across an instance.</span></span><br><span class="line"><span class="comment"># To disable cloud-init's network configuration capabilities, write a file</span></span><br><span class="line"><span class="comment"># /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:</span></span><br><span class="line"><span class="comment"># network: &#123;config: disabled&#125;</span></span><br><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">eno1:</span></span><br><span class="line">      <span class="attr">addresses:</span> <span class="string">[]</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">dhcp6:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">eno2:</span></span><br><span class="line">      <span class="attr">addresses:</span> <span class="string">[]</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">dhcp6:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">bonds:</span></span><br><span class="line">    <span class="attr">bond0:</span></span><br><span class="line">      <span class="attr">interfaces:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">eno1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">eno2</span></span><br><span class="line">      <span class="attr">addresses:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span><span class="string">/24</span></span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">78.41</span><span class="number">.207</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">nameservers:</span></span><br><span class="line">        <span class="attr">addresses:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">8.8</span><span class="number">.4</span><span class="number">.4</span></span><br><span class="line">        <span class="attr">search:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">test.com</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">802.</span><span class="string">3ad</span></span><br><span class="line">        <span class="attr">lacp-rate:</span> <span class="string">fast</span></span><br><span class="line">        <span class="attr">mii-monitor-interval:</span> <span class="number">100</span></span><br><span class="line">        <span class="attr">transmit-hash-policy:</span> <span class="string">layer2</span></span><br></pre></td></tr></table></figure>

<p>编辑完配置文件后，通过 netplan apply 生效，重启。</p>
<p>重启完后，检查bond状态。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/net/bonding/bond0</span><br></pre></td></tr></table></figure>

<h2 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h2><p>关于 mode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Mode 0</span><br><span class="line">balance-rr</span><br><span class="line"></span><br><span class="line">Round-robin policy: Transmit packets in sequential order from the first available slave through the last. This mode provides load balancing and fault tolerance.</span><br><span class="line"></span><br><span class="line">Mode 1</span><br><span class="line">active-backup</span><br><span class="line"></span><br><span class="line">Active-backup policy: Only one slave in the bond is active. A different slave becomes active if, and only if, the active slave fails. The bond’s MAC address is externally visible on only one port (network adapter) to avoid confusing the switch. This mode provides fault tolerance. The primary option affects the behavior of this mode.</span><br><span class="line"></span><br><span class="line">Mode 2</span><br><span class="line">balance-xor</span><br><span class="line"></span><br><span class="line">XOR policy: Transmit based on selectable hashing algorithm. The default policy is a simple source+destination MAC address algorithm. Alternate transmit policies may be selected via the xmit_hash_policy option, described below. This mode provides load balancing and fault tolerance.</span><br><span class="line"></span><br><span class="line">Mode 3</span><br><span class="line">broadcast</span><br><span class="line"></span><br><span class="line">Broadcast policy: transmits everything on all slave interfaces. This mode provides fault tolerance.</span><br><span class="line"></span><br><span class="line">Mode 4</span><br><span class="line">802.3ad</span><br><span class="line"></span><br><span class="line">IEEE 802.3ad Dynamic link aggregation. Creates aggregation groups that share the same speed and duplex settings. Utilizes all slaves in the active aggregator according to the 802.3ad specification.</span><br><span class="line"></span><br><span class="line">Prerequisites:</span><br><span class="line"></span><br><span class="line">Ethtool support in the base drivers for retrieving the speed and duplex of each slave.</span><br><span class="line">A switch that supports IEEE 802.3ad Dynamic link aggregation. Most switches will require some type of configuration to enable 802.3ad mode.</span><br><span class="line">Mode 5</span><br><span class="line">balance-tlb</span><br><span class="line"></span><br><span class="line">Adaptive transmit load balancing: channel bonding that does not require any special switch support. The outgoing traffic is distributed according to the current load (computed relative to the speed) on each slave. Incoming traffic is received by the current slave. If the receiving slave fails, another slave takes over the MAC address of the failed receiving slave.</span><br><span class="line"></span><br><span class="line">Prerequisites:</span><br><span class="line"></span><br><span class="line">Ethtool support in the base drivers for retrieving the speed of each slave.</span><br><span class="line">Mode 6</span><br><span class="line">balance-alb</span><br><span class="line"></span><br><span class="line">Adaptive load balancing: includes balance-tlb plus receive load balancing (rlb) for IPV4 traffic, and does not require any special switch support. The receive load balancing is achieved by ARP negotiation. The bonding driver intercepts the ARP Replies sent by the local system on their way out and overwrites the source hardware address with the unique hardware address of one of the slaves in the bond such that different peers use different hardware addresses for the server.</span><br></pre></td></tr></table></figure>

<p>关于 xmit_hash_policy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">layer2 Uses XOR of hardware MAC addresses to generate the hash. This algorithm will place all traffic to a particular network peer on the same slave.</span><br><span class="line"></span><br><span class="line">layer2+3 Uses XOR of hardware MAC addresses and IP addresses to generate the hash. This algorithm will place all traffic to a particular network peer on the same slave.</span><br><span class="line"></span><br><span class="line">layer3+4 This policy uses upper layer protocol information, when available, to generate the hash. This allows for traffic to a particular network peer to span multiple slaves, although a single connection will not span multiple slaves.</span><br><span class="line"></span><br><span class="line">encap2+3 This policy uses the same formula as layer2+3 but it relies on skb_flow_dissect to obtain the header fields which might result in the use of inner headers if an encapsulation protocol is used.</span><br><span class="line"></span><br><span class="line">encap3+4 This policy uses the same formula as layer3+4 but it relies on skb_flow_dissect to obtain the header fields which might result in the use of inner headers if an encapsulation protocol is used.</span><br><span class="line"></span><br><span class="line">The default value is layer2. This option was added in bonding version 2.6.3. In earlier versions of bonding, this parameter does not exist, and the layer2 policy is the only policy. The layer2+3 value was added for bonding version 3.2.2.</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://help.ubuntu.com/community/UbuntuBonding/" target="_blank" rel="noopener">https://help.ubuntu.com/community/UbuntuBonding/</a><br><a href="https://www.snel.com/support/how-to-set-up-lacp-bonding-on-ubuntu-18-04-with-netplan/" target="_blank" rel="noopener">https://www.snel.com/support/how-to-set-up-lacp-bonding-on-ubuntu-18-04-with-netplan/</a><br><a href="https://www.linuxidc.com/Linux/2013-10/91118.htm" target="_blank" rel="noopener">https://www.linuxidc.com/Linux/2013-10/91118.htm</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://github.com/r0manj/2020/06/01/Linux%E4%B8%8B%E7%9A%84dm%E8%AE%BE%E5%A4%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rohman.Zhu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="R0hman の 实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/01/Linux%E4%B8%8B%E7%9A%84dm%E8%AE%BE%E5%A4%87/" itemprop="url">Linux下的dm设备</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-01T10:41:58+08:00">
                2020-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>之前在Linux中，看到一些名字为 dm-xx 的设备。<br>其实dm是Device Mapper的缩写，Device Mapper 是 Linux 2.6 内核中提供的一种从逻辑设备到物理设备的映射框架机制，在该机制下，用户可以很方便的根据自己的需要制定实现存储资源的管理策略，当前比较流行的 Linux 下的逻辑卷管理器如 LVM2（Linux Volume Manager 2 version)、EVMS(Enterprise Volume Management System)、dmraid(Device Mapper Raid Tool)等都是基于该机制实现的。</p>
<blockquote>
<p>Device Mapper是Linux操作系统中块设备一级提供的一种主要映射机制，现在已被多数Linux下的逻辑卷管理器所采用。在该机制下，实现用户自定义的存储资源管理策略变得极其方便。理解device mapper所提供的映射机制，也是进一步理解Linux下一些常见逻辑卷管理器实现的基础。</p>
</blockquote>
<h1 id="dm-xx-与-当前设备的对应关系"><a href="#dm-xx-与-当前设备的对应关系" class="headerlink" title="dm-xx 与 当前设备的对应关系"></a>dm-xx 与 当前设备的对应关系</h1><p>使用命令 dmsetup ls 查看，dm后面的数字对应(253,xx)后面的数字。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@mylnx01 ~]<span class="comment"># dmsetup ls </span></span><br><span class="line">VolGroup03-LogVol00--PS--user--snapshot (253, 8)</span><br><span class="line">VolGroup00-LogVol00--PS--user--snapshot (253, 2)</span><br><span class="line">VolGroup05-LogVol00     (253, 3)</span><br><span class="line">VolGroup04-LogVol00     (253, 5)</span><br><span class="line">VolGroup05-LogVol00--PS--user--snapshot (253, 4)</span><br><span class="line">VolGroup03-LogVol00     (253, 7)</span><br><span class="line">VolGroup02-LogVol00--PS--user--snapshot (253, 10)</span><br><span class="line">VolGroup02-LogVol00     (253, 9)</span><br><span class="line">VolGroup01-LogVol00     (253, 11)</span><br><span class="line">VolGroup00-LogVol01     (253, 1)</span><br><span class="line">VolGroup04-LogVol00--PS--user--snapshot (253, 6)</span><br><span class="line">VolGroup00-LogVol00     (253, 0)</span><br><span class="line">VolGroup01-LogVol00--PS--user--snapshot (253, 12)</span><br></pre></td></tr></table></figure>

<p>使用 dmsetup info 查看详细信息。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><p><a href="https://www.cnblogs.com/kerrycode/p/6187148.html" target="_blank" rel="noopener">https://www.cnblogs.com/kerrycode/p/6187148.html</a></p>
</li>
<li><p><a href="https://www.ibm.com/developerworks/cn/linux/l-devmapper/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/linux/l-devmapper/index.html</a></p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://github.com/r0manj/2020/06/01/Windows%E6%8C%82%E8%BD%BDNAS%E6%95%85%E9%9A%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rohman.Zhu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="R0hman の 实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/01/Windows%E6%8C%82%E8%BD%BDNAS%E6%95%85%E9%9A%9C/" itemprop="url">Windows挂载NAS故障</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-01T06:11:32+08:00">
                2020-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Windows-Server/" itemprop="url" rel="index">
                    <span itemprop="name">Windows Server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="故障描述"><a href="#故障描述" class="headerlink" title="故障描述"></a>故障描述</h1><p>前提条件：</p>
<ol>
<li>windows server已经加域。</li>
<li>该管理员是属于Administrators组下面。</li>
<li>服务器到 NAS 的防火墙已经开通。</li>
<li>采用samba协议连接。</li>
</ol>
<p>端口：</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">端口</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">TCP</td>
<td align="center">139，445</td>
<td align="center">139(NetBIOS-SSN),445(Microsoft-DS)</td>
</tr>
<tr>
<td align="center">UPD</td>
<td align="center">137,138,139，445</td>
<td align="center">137-138(Nmbd)</td>
</tr>
</tbody></table>
<p>在OS中添加网络映射盘后，到CMD（以管理员身份运行）没有办法访问该映射盘。</p>
<p>程序报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The system cannot find the path specified.</span><br></pre></td></tr></table></figure>

<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>UAC将Administrators组的成员视为标准用户。</p>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><h2 id="临时解决方法："><a href="#临时解决方法：" class="headerlink" title="临时解决方法："></a>临时解决方法：</h2><p>在管理员模式下执行 net use 重新映射</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net use [映射盘符]    \\[NAS IP]\Volume Name</span><br></pre></td></tr></table></figure>

<h2 id="根治方法："><a href="#根治方法：" class="headerlink" title="根治方法："></a>根治方法：</h2><ol>
<li>单击“ 开始”，在“ 启动程序和文件”框中键入regedit，然后按Enter。</li>
<li>找到并右键单击注册表子项HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Policies \ System。</li>
<li>点击“ 新建”，然后单击“ DWORD值”。</li>
<li>键入EnableLinkedConnections，然后按Enter。</li>
<li>右键单击EnableLinkedConnections，然后单击“ 修改”。</li>
<li>在“ 数值数据”框中，键入1，然后单击“ 确定”。</li>
<li>退出注册表编辑器，然后重新启动计算机。</li>
</ol>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ee844140(v=ws.10)?redirectedfrom=MSDN" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ee844140(v=ws.10)?redirectedfrom=MSDN</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://github.com/r0manj/2020/05/30/RD%E4%BC%9A%E8%AF%9D%E4%B8%BB%E6%9C%BA120%E5%A4%A9%E5%AE%BD%E9%99%90%E6%9C%9F%E5%B7%B2%E8%BF%87%E7%9A%84%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rohman.Zhu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="R0hman の 实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/30/RD%E4%BC%9A%E8%AF%9D%E4%B8%BB%E6%9C%BA120%E5%A4%A9%E5%AE%BD%E9%99%90%E6%9C%9F%E5%B7%B2%E8%BF%87%E7%9A%84%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" itemprop="url">RD会话主机120天宽限期已过的临时解决方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-05-30T22:52:12+08:00">
                2020-05-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Windows-Server/" itemprop="url" rel="index">
                    <span itemprop="name">Windows Server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="故障描述"><a href="#故障描述" class="headerlink" title="故障描述"></a>故障描述</h1><p>未配置远程桌面会话主机服务器的授权模式</p>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><ol>
<li>根本原因： 没有配置RD授权服务器的地址与授权模式。</li>
<li>直接原因： 临时License 是120天的宽限期，当前已过期。</li>
</ol>
<h1 id="临时解决方法"><a href="#临时解决方法" class="headerlink" title="临时解决方法"></a>临时解决方法</h1><p>可尝试删除如下注册表</p>
<p>HKEY_LOCAL_MACHINE\Software\Microsoft\MSLicensing</p>
<p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\RCM\Grace Period</p>
<blockquote>
<p>如果无法直接删除，鼠标右键 Grace Period ，选择“权限”，点击“高级”，进“所有者” 选项卡，将所有者改成当前用户，并复选“替换子容器和对象的所有者”后，点击确定。</p>
</blockquote>
<blockquote>
<p>右键 Grace Period ，选择“权限” ， 添加everyone 权限后，将其删除。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://github.com/r0manj/2020/05/30/Linux%E4%B8%8Bdmidecode%E5%91%BD%E4%BB%A4%E8%8E%B7%E5%8F%96%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rohman.Zhu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="R0hman の 实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/30/Linux%E4%B8%8Bdmidecode%E5%91%BD%E4%BB%A4%E8%8E%B7%E5%8F%96%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AF/" itemprop="url">Linux下dmidecode命令获取硬件信息</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-05-30T21:44:32+08:00">
                2020-05-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="dmidecode"><a href="#dmidecode" class="headerlink" title="dmidecode"></a>dmidecode</h1><p>dmidecode在 Linux 系统下获取有关硬件方面的信息。dmidecode 遵循 SMBIOS/DMI 标准，以一种可读的方式dump出机器的DMI(Desktop Management Interface)信息, 其输出的信息包括 BIOS、系统、主板、处理器、内存、缓存等等, 既可以得到当前的配置，也可以得到系统支持的最大配置，比如说支持的最大内存数等。</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Debian/Ubuntu</span></span><br><span class="line">aptitude install dmidecode</span><br><span class="line"><span class="comment"># Fedora</span></span><br><span class="line">yum installl dmidecode</span><br><span class="line"><span class="comment"># Arch Linux</span></span><br><span class="line">pacman -S dmidecode</span><br><span class="line"><span class="comment"># Gentoo</span></span><br><span class="line">emerge -av dmidecode</span><br></pre></td></tr></table></figure>

<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、查看内存槽数、那个槽位插了内存，大小是多少</span></span><br><span class="line">dmidecode|grep -P -A5 <span class="string">"Memory\s+Device"</span>|grep Size|grep -v Range</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、查看最大支持内存数</span></span><br><span class="line"></span><br><span class="line">dmidecode|grep -P <span class="string">'Maximum\s+Capacity'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、查看槽位上内存的速率，没插就是unknown。</span></span><br><span class="line"></span><br><span class="line">dmidecode|grep -A16 <span class="string">"Memory Device"</span>|grep <span class="string">'Speed'</span></span><br></pre></td></tr></table></figure>

<p>输出格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Handle 0×0002</span><br><span class="line">DMI <span class="built_in">type</span> 2, 8 bytes</span><br><span class="line">Base Board Information</span><br><span class="line">Manufacturer:Intel</span><br><span class="line">Product Name: C440GX+</span><br><span class="line">Version: 727281-0001</span><br><span class="line">Serial Number: INCY92700942</span><br></pre></td></tr></table></figure>

<ol>
<li>recode id(handle): DMI表中的记录标识符，这是唯一的,比如上例中的Handle 0×0002。</li>
<li>dmi type id: 记录的类型，譬如说:BIOS，Memory，上例是type 2，即”Base Board Information”</li>
<li>recode size: DMI表中对应记录的大小，上例为8 bytes.（不包括文本信息，所有实际输出的内容比这个size要更大。）<br>记录头之后就是记录的值：</li>
<li>decoded values: 记录值可以是多行的，比如上例显示了主板的制造商(manufacturer)、model、version以及serial Number。</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 最简单的的显示全部dmi信息：</span></span><br><span class="line"><span class="comment">#这样将输出所有的dmi信息，你可能会被一大堆的信息吓坏，通常可以使用下面的方法。</span></span><br><span class="line">dmidecode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.更精简的信息显示：</span></span><br><span class="line"><span class="comment"># -q(–quite) 只显示必要的信息，这个很管用哦。</span></span><br><span class="line"></span><br><span class="line">dmidecode -q</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.显示指定类型的信息：</span></span><br><span class="line"><span class="comment"># 通常我只想查看某类型，比如CPU，内存或者磁盘的信息而不是全部的。这可以使用-t(–type TYPE)来指定信息类型：</span></span><br><span class="line"><span class="comment"># (显示bios和processor)</span></span><br><span class="line">dmidecode -t 0,4 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 通过关键字查询信息</span></span><br><span class="line">dmidecode -s system-serial-number</span><br><span class="line"><span class="comment">#-s (–string keyword)支持的keyword包括：bios-vendor,bios-version, bios-release-date,system-manufacturer, system-product-name, system-version, system-serial-number,baseboard-manu-facturer,baseboard-product-name, baseboard-version, baseboard-serial-number, baseboard-asset-tag,chassis-manufacturer, chas-sis-version, chassis-serial-number, chassis-asset-tag,processor-manufacturer, processor-version.</span></span><br></pre></td></tr></table></figure>

<p>Type Information</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">0 BIOS</span><br><span class="line">1 System</span><br><span class="line">2 Base Board</span><br><span class="line">3 Chassis</span><br><span class="line">4 Processor</span><br><span class="line">5 Memory Controller</span><br><span class="line">6 Memory Module</span><br><span class="line">7 Cache</span><br><span class="line">8 Port Connector</span><br><span class="line">9 System Slots</span><br><span class="line">10 On Board Devices</span><br><span class="line">11 OEM Strings</span><br><span class="line">12 System Configuration Options</span><br><span class="line">13 BIOS Language</span><br><span class="line">14 Group Associations</span><br><span class="line">15 System Event Log</span><br><span class="line">16 Physical Memory Array</span><br><span class="line">17 Memory Device</span><br><span class="line">18 32-bit Memory Error</span><br><span class="line">19 Memory Array Mapped Address</span><br><span class="line">20 Memory Device Mapped Address</span><br><span class="line">21 Built-in Pointing Device</span><br><span class="line">22 Portable Battery</span><br><span class="line">23 System Reset</span><br><span class="line">24 Hardware Security</span><br><span class="line">25 System Power Controls</span><br><span class="line">26 Voltage Probe</span><br><span class="line">27 Cooling Device</span><br><span class="line">28 Temperature Probe</span><br><span class="line">29 Electrical Current Probe</span><br><span class="line">30 Out-of-band Remote Access</span><br><span class="line">31 Boot Integrity Services</span><br><span class="line">32 System Boot</span><br><span class="line">33 64-bit Memory Error</span><br><span class="line">34 Management Device</span><br><span class="line">35 Management Device Component</span><br><span class="line">36 Management Device Threshold Data</span><br><span class="line">37 Memory Channel</span><br><span class="line">38 IPMI Device</span><br><span class="line">39 Power Supply</span><br></pre></td></tr></table></figure>

<h1 id="实例：-查看当前服务器支持可扩容的内存"><a href="#实例：-查看当前服务器支持可扩容的内存" class="headerlink" title="实例： 查看当前服务器支持可扩容的内存"></a>实例： 查看当前服务器支持可扩容的内存</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前内存大小</span></span><br><span class="line">free </span><br><span class="line">cat /proc/meminfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用dmidecode</span></span><br><span class="line">dmidecode -t 16 | grep Maximum</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看内存插槽</span></span><br><span class="line">dmidecode -t 17</span><br><span class="line">dmidecode -t 17 | grep Size</span><br><span class="line"><span class="comment"># 如果Size为No Module Installed 表示该插槽当前未有插入内存。</span></span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="http://www.ttlsa.com/linux/the-linux-dmidecode-command-to-get-the-hardware-information/" target="_blank" rel="noopener">http://www.ttlsa.com/linux/the-linux-dmidecode-command-to-get-the-hardware-information/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://github.com/r0manj/2020/05/30/Linux%E4%B8%8B%E7%9A%84%E9%98%B5%E5%88%97%E5%8D%A1%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rohman.Zhu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="R0hman の 实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/30/Linux%E4%B8%8B%E7%9A%84%E9%98%B5%E5%88%97%E5%8D%A1%E5%B7%A5%E5%85%B7/" itemprop="url">Linux下的阵列卡工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-05-30T21:19:42+08:00">
                2020-05-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h1><p>对已经做了磁盘阵列的服务器，需要在OS层查看阵列状态信息，如硬件的健康状态、阵列等级……</p>
<p>对于Linux，可以使用MegaCli这个工具。</p>
<h1 id="MegaCli-介绍"><a href="#MegaCli-介绍" class="headerlink" title="MegaCli 介绍"></a>MegaCli 介绍</h1><p>MegaCli是一款管理维护硬件RAID软件，可以通过它来了解当前raid卡的所有信息，包括 raid卡的型号，raid的阵列类型，raid 上各磁盘状态。</p>
<p>这个工具有Linux和Windows两个版本。本文先看Linux下的使用方式。</p>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><p>如果是通过Linux自身查看：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看软件RAID</span></span><br><span class="line">cat  /proc/mdstat</span><br><span class="line"><span class="comment"># 查看硬件RAID：查看RAID的厂家、型号、级别</span></span><br><span class="line">dmesg | grep -i raid</span><br><span class="line">cat /proc/scsi/scsi</span><br></pre></td></tr></table></figure>

<p>通过 MegaCli：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 【查raid级别】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -Lall -aALL </span><br><span class="line"><span class="comment"># 【查raid卡信息】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -AdpAllInfo -aALL</span><br><span class="line"><span class="comment"># 查看【硬盘信息】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aALL </span><br><span class="line"><span class="comment">#  【查看电池信息】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -aAll</span><br><span class="line"><span class="comment"># 【查看raid卡日志】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -FwTermLog -Dsply -aALL </span><br><span class="line"><span class="comment"># 【显示适配器个数】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -adpCount </span><br><span class="line"><span class="comment"># 【显示适配器时间】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -AdpGetTime –aALL</span><br><span class="line"><span class="comment">#  【显示所有适配器信息】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -AdpAllInfo -aAll </span><br><span class="line"><span class="comment">#  【显示所有逻辑磁盘组信息】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -LALL -aAll</span><br><span class="line"><span class="comment"># 【显示所有的物理信息】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aAll </span><br><span class="line"><span class="comment"># 【查看充电状态】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuStatus -aALL |grep ‘Charger Status’ </span><br><span class="line"><span class="comment">#【显示BBU状态信息】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuStatus -aALL</span><br><span class="line"><span class="comment"># 【显示BBU容量信息】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuCapacityInfo -aALL</span><br><span class="line"><span class="comment"># 【显示BBU设计参数】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuDesignInfo -aALL </span><br><span class="line"><span class="comment"># 【显示当前BBU属性】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuProperties -aALL </span><br><span class="line"><span class="comment"># 【显示Raid卡型号，Raid设置，Disk相关信息】</span></span><br><span class="line">/opt/MegaRAID/MegaCli/MegaCli64 -cfgdsply -aALL</span><br></pre></td></tr></table></figure>

<p>这个软件貌似支持从系统层做RAID，但我们一般都在服务器的BIOS设置，这里的命令仅做记录，并没有验证：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#6.创建一个 raid5 阵列，由物理盘 2,3,4 构成，该阵列的热备盘是物理盘 5</span></span><br><span class="line">/opt/MegaCli -CfgLdAdd -r5 [1:2,1:3,1:4] WB Direct -Hsp[1:5] -a0</span><br><span class="line"></span><br><span class="line"><span class="comment">#7.创建阵列，不指定热备</span></span><br><span class="line">/opt/MegaCli -CfgLdAdd -r5 [1:2,1:3,1:4] WB Direct -a0</span><br><span class="line"></span><br><span class="line"><span class="comment">#8.删除阵列</span></span><br><span class="line">/opt/MegaCli -CfgLdDel -L1 -a0</span><br><span class="line"></span><br><span class="line"><span class="comment">#9.在线添加磁盘</span></span><br><span class="line">/opt/MegaCli -LDRecon -Start -r5 -Add -PhysDrv[1:4] -L1 -a0</span><br><span class="line"></span><br><span class="line"><span class="comment">#10.阵列创建完后，会有一个初始化同步块的过程，可以看看其进度。</span></span><br><span class="line">/opt/MegaCli -LDInit -ShowProg -LALL -aALL</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者以动态可视化文字界面显示</span></span><br><span class="line">/opt/MegaCli -LDInit -ProgDsply -LALL -aALL</span><br><span class="line"></span><br><span class="line"><span class="comment">#11.查看阵列后台初始化进度</span></span><br><span class="line">/opt/MegaCli -LDBI -ShowProg -LALL -aALL</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者以动态可视化文字界面显示</span></span><br><span class="line">/opt/MegaCli -LDBI -ProgDsply -LALL -aALL</span><br><span class="line"></span><br><span class="line"><span class="comment">#12.指定第 5 块盘作为全局热备</span></span><br><span class="line">/opt/MegaCli -PDHSP -Set [-EnclAffinity] [-nonRevertible] -PhysDrv[1:5] -a0</span><br><span class="line"></span><br><span class="line"><span class="comment">#13.指定为某个阵列的专用热备</span></span><br><span class="line">/opt/MegaCli -PDHSP -Set [-Dedicated [-Array1]] [-EnclAffinity] [-nonRevertible] -PhysDrv[1:5] -a0</span><br><span class="line"></span><br><span class="line"><span class="comment">#14.删除全局热备</span></span><br><span class="line">/opt/MegaCli -PDHSP -Rmv -PhysDrv[1:5] -a0</span><br><span class="line"></span><br><span class="line"><span class="comment">#15.将某块物理盘下线/上线</span></span><br><span class="line">/opt/MegaCli -PDOffline -PhysDrv [1:4] -a0</span><br><span class="line">/opt/MegaCli -PDOnline -PhysDrv [1:4] -a0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 16.查看物理磁盘重建进度</span></span><br><span class="line">/opt/MegaCli -PDRbld -ShowProg -PhysDrv [1:5] -a0</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者以动态可视化文字界面显示</span></span><br><span class="line">/opt/MegaCli -PDRbld -ProgDsply -PhysDrv [1:5] -a0</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://blog.51cto.com/hmtk520/2140657" target="_blank" rel="noopener">https://blog.51cto.com/hmtk520/2140657</a><br><a href="http://www.ttlsa.com/tools/megacli-tool-query-raid-status/" target="_blank" rel="noopener">http://www.ttlsa.com/tools/megacli-tool-query-raid-status/</a><br>下载地址：<a href="https://www.broadcom.com/site-search?q=megacli" target="_blank" rel="noopener">https://www.broadcom.com/site-search?q=megacli</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://github.com/r0manj/2020/05/30/Windows%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E4%BA%8B%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rohman.Zhu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="R0hman の 实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/30/Windows%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E4%BA%8B%E4%BB%B6/" itemprop="url">Windows自动重启事件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-05-30T17:59:23+08:00">
                2020-05-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Windows-Server/" itemprop="url" rel="index">
                    <span itemprop="name">Windows Server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="故障描述"><a href="#故障描述" class="headerlink" title="故障描述"></a>故障描述</h1><p>服务器在凌晨2点左右自动重启了。</p>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><ol>
<li>打开事件查看器，看到有安装补丁的提示“将在15分钟内重启”</li>
<li>事件ID，1074。</li>
<li>在C:\Windows\下的windowsupdates.log存在expire记录。（而不是deadline）</li>
</ol>
<blockquote>
<p>可得直接原因： 系统自动安装补丁后，触发的自动重启。</p>
</blockquote>
<p>然而我们的服务器补丁策略应该不是默认安装的，应该是哪里设置错误了。</p>
<blockquote>
<p>WSUS服务器已经没有对补丁设置Deadline，服务器默认只能搜索到补丁，并且提示安装，并不是默认安装。</p>
</blockquote>
<p>进入服务器运行rsop.msc ，查看更新的组策略跟目标策略不一致。当前策略设置的是默认安装补丁，即是“计划安装”，而不是“提示安装”。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">管理模板--》Windows组件--》Windows Update</span><br></pre></td></tr></table></figure>

<blockquote>
<p>根本原因：服务器设置了错误的OU，导致补丁到服务器中是默认安装补丁。</p>
</blockquote>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>在域控中，将目标服务器转移OU。</p>
<p>后续改造：</p>
<ol>
<li>域控的OU策略，统一改成提示安装。</li>
<li>WSUS服务器不设置审批期限。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://github.com/r0manj/2020/05/24/Ubuntu18-04%E8%AE%BE%E7%BD%AENTP%E4%B8%8E%E7%BD%91%E5%8D%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rohman.Zhu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="R0hman の 实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/24/Ubuntu18-04%E8%AE%BE%E7%BD%AENTP%E4%B8%8E%E7%BD%91%E5%8D%A1/" itemprop="url">Ubuntu18.04设置NTP与网卡</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-05-24T18:11:07+08:00">
                2020-05-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/Ubuntu/" itemprop="url" rel="index">
                    <span itemprop="name">Ubuntu</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="网卡设置"><a href="#网卡设置" class="headerlink" title="网卡设置"></a>网卡设置</h1><p>18.04开始网卡配置不再是 /etc/network/interfaces 控制，而是在 /etc/netplan/ 下的 yaml文件。</p>
<blockquote>
<p>yaml文件是通过缩进控制分级，不能使用tab。</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">eno1:</span></span><br><span class="line">      <span class="attr">addresses:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span><span class="string">/24</span></span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span></span><br></pre></td></tr></table></figure>

<p>保存后使用 netplan apply ，使网卡生效。</p>
<p>DNS不再是直接修改 /etc/resolv.conf 来控制，默认DNS服务器都会指向本地 127.0.0.53， 并且由 systemd-resolved 控制。</p>
<p>配置文件存放于 /etc/systemd/resolve/resolv.conf </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Resolve]</span><br><span class="line">DNS&#x3D;8.8.8.8 8.8.8.4</span><br></pre></td></tr></table></figure>

<p>重启 systemd-resolved 服务。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart systemd-resolved.service</span><br></pre></td></tr></table></figure>

<p>查看DNS设置状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemd-resolved --status</span><br></pre></td></tr></table></figure>

<h1 id="设置NTP"><a href="#设置NTP" class="headerlink" title="设置NTP"></a>设置NTP</h1><p>设置时区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>

<p>设置NTP服务器地址</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/timesyncd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#---timesyncd.conf---#</span></span><br><span class="line">[Time]</span><br><span class="line">NTP=</span><br><span class="line"><span class="comment">#---timesyncd.conf---#</span></span><br><span class="line"></span><br><span class="line">timedatectl <span class="built_in">set</span>-ntp yes</span><br><span class="line"></span><br><span class="line">systemctl restart systemd-timesyncd.service</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://wiki.archlinux.org/index.php/Systemd-timesyncd" target="_blank" rel="noopener">https://wiki.archlinux.org/index.php/Systemd-timesyncd</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/">BACK</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/6/">NEXT</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Rohman.Zhu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">241</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">85</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rohman.Zhu</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count"></span>
  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
